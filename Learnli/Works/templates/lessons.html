 {% extends 'base.html' %}

{% block content %}
<div class="container-fluid">
  <div class="row">
    <!-- Sidebar Menu -->
    <div class="col-md-3 sidebar">
      <h4>Lessons</h4>
      <input type="text" id="mySearch" onkeyup="myFunction()" placeholder="Search.." class="form-control" title="Type in a category">
      <ul id="myMenu" class="lesson-list">
        {% for lesson in lessons %}
          <li><a href="#" onclick="loadVideo({{ lesson.id }})">{{ lesson.title }}</a></li>
        {% endfor %}
      </ul>
    </div>

    <!-- Main Content for Video Player and Lesson Details -->
    <div class="col-md-9">
      <div class="video-container">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h2 id="lesson-title">{{ selected_lesson.title }}</h2>
            <p><strong>Uploaded on:</strong> {{ selected_lesson.created_on }}</p>
            <p><strong>Instructor:</strong> {{ selected_lesson.taught_by }}</p>
          </div>
          <!-- Next and Previous Buttons -->
          <div>
            <button onclick="prevVideo()" class="btn btn-outline-secondary btn-sm"><i class="fas fa-arrow-left"></i> Previous</button>
            <button onclick="nextVideo()" class="btn btn-outline-secondary btn-sm"><i class="fas fa-arrow-right"></i> Next</button>
          </div>
        </div>
        
        <!-- Video Player -->
        <div class="video-player mt-2">
          <video id="videoPlayer" controls width="100%" height="400">
            <source id="videoSource" src="{{ selected_lesson.video.url }}" type="video/mp4">
            Your browser does not support the video tag.
          </video>
        </div>

        <!-- Video Controls (Download and Navigation Buttons) -->
        <div class="video-controls d-flex justify-content-between mt-3">
          <button class="btn btn-sm btn-outline-primary">
            <i class="fas fa-arrow-left"></i> Back to Courses
          </button>
          {% if selected_lesson.notes %}
          <button class="btn btn-sm btn-outline-secondary">
            <a href="{{ selected_lesson.notes.url }}" download><i class="fas fa-download"></i> Notes</a>
          </button>
          {% endif %}
          <button class="btn btn-sm btn-outline-secondary">
            <a href="{{ selected_lesson.video.url }}" download><i class="fas fa-download"></i> Video</a>
          </button>
          {% if request.user == selected_lesson.taught_by %}
          <button class="btn btn-sm btn-outline-secondary">
            <a href="{% url 'edit_lesson' selected_lesson.id %}"><i class="fas fa-edit"></i> Edit</a>
          </button>
          <button class="btn btn-sm btn-outline-danger">
            <a href="{% url 'delete_lesson' selected_lesson.id %}"><i class="fas fa-trash-alt"></i> Delete</a>
          </button>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Function to load video based on lesson ID
function loadVideo(lessonId) {
  fetch(`/api/lessons/${lessonId}/`)
    .then(response => response.json())
    .then(data => {
      document.getElementById("videoSource").src = data.video_url;
      document.getElementById("videoPlayer").load();
      document.getElementById("lesson-title").innerText = data.title;
    })
    .catch(error => console.error("Error loading video:", error));
}

// Function to load the next video
function nextVideo() {
  const nextIndex = currentVideoIndex + 1;
  if (nextIndex < lessons.length) {
    loadVideo(nextIndex);
    currentVideoIndex = nextIndex;
  }
}

// Function to load the previous video
function prevVideo() {
  const prevIndex = currentVideoIndex - 1;
  if (prevIndex >= 0) {
    loadVideo(prevIndex);
    currentVideoIndex = prevIndex;
  }
}
</script>
{% endblock %}
